<?php
    include_once "./libs/login.php";
?>

<!DOCTYPE HTML>
<html>
<head>
    <meta http-equiv="content-type" content="text/html;charset=utf-8">
    <title>FamilyDecoration</title>
<link rel="stylesheet" href="resources/FamilyDecoration-all.css"/>
<script type="text/javascript" src="app.js"></script>
    <link href="resources/css/global.css" rel="stylesheet" />
    <script type="text/javascript" src="resources/locale/ext-lang-zh_CN.js"></script>
</head>
<body>
    <div id="userInfo" class="x-hide-display">
        <span>用户信息:</span>
        <span>账号:</span>
        <span name="account"></span>
        <span>权限:</span>
        <span name="authority"></span>
        <a href="javascript:void(0);" id="logout">注销</a>
    </div>

    <div id="tipBox"
         style="position:absolute;height:0px;top:10px;width:100%;text-align: right;line-height: 24px;display: none;">
    <span class="text" style="position:absolute;right: 20px;display:inline-block;background-color:#99bce8;
        color:#000;border-radius:3px;padding:0 10px;margin-top: 4px;
        border: 1px solid #99bce8;z-index: 9999999;"></span>
    </div>
    <div id="topMask" style="display:none;position: absolute;width: 100%;height:100%;z-index: 999999999;cursor:wait;"></div>

    <script type="text/javascript">
        Ext.onReady(function (){

            document.getElementById('logout').onclick = function (){
                Ext.Ajax.request({
                    url: './libs/user.php?action=logout',
                    method: 'POST',
                    callback: function (opts, success, res){
                        if (success) {
                            var obj = Ext.decode(res.responseText);
                            if (obj.status == 'successful') {
                                location.href = './login.html';
                            }
                        }
                    }
                })
            }

            Ext.define('User', {
                singleton: true,

                name: '<?php echo $_SESSION["name"]; ?>',

                level: '<?php echo $_SESSION["level"]; ?>',

                isAdmin: function (){
                    return this.level == 1;
                },

                isManager: function (){
                    return this.level == 2;
                },

                isGeneral: function (){
                    return this.level == 3;
                },

                getStatus: function (){
                    var level = this.level,
                        status = '';
                    switch (level){
                        case "1":
                        status = '管理员';
                        break;
                        case "2":
                        status = '群主';
                        break;
                        case "3":
                        status = '员工';
                        break;
                        default:
                        status = '未知';
                        break;
                    }
                    return status;
                },

                getName: function (){
                    return this.name;
                }
            });
            Ext.select('[name="authority"]').elements[0].innerHTML = User.getStatus();
            Ext.select('[name="account"]').elements[0].innerHTML = User.getName();
            
        });
    </script>
</body>
</html>
